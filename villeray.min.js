const u=[];export async function mount(t,e){const n=document.body.querySelector(t);n===null?console.log(new Error(`no match for '${t}' in document body`)):(u.push({elem:n,app:e}),await refresh())}export async function refresh(){const t=document.activeElement?.id??"";for(const e of u){const n=await i(e.app());e.elem=await w(e.elem,n)}if(t!==""){const e=document.getElementById(t);if(e===null)return;const n=e.onfocus;delete e.onfocus,e.focus(),e.onfocus=n}}class l{constructor(e,n,r){var s;if(Object.assign(this,{tag:e,attrs:n,children:r}),e==="a"){const o=p(n.href??"",n.params??{});this.attrs={...n,href:o},n.href===void 0&&((s=this.attrs).onclick??(s.onclick=c=>{c.ctrlKey||c.shiftKey||c.metaKey||(setParams(n.params??{}),c.preventDefault())}))}}}export function h(t,e,...n){if(typeof t!="string"){const r="error: 'tag' must be a string";return console.log(new Error(r),t),`(${r})`}if(typeof e!="object"){const r="error: 'attrs' must be an object";return console.log(new Error(r),t),`(${r})`}return new l(t,e,n)}async function i(t){switch(t?.constructor){case l:return t;case String:case Number:return String(t);case Boolean:case void 0:return"";case Promise:return i(await t);default:return h("pre",{},JSON.stringify(t,null,2))}}async function w(t,e){return typeof e=="string"?t.nodeType===Node.TEXT_NODE?(t.textContent!==e&&(t.textContent=e),t):y(t,await f(e)):e.tag.toUpperCase()===t.tagName?(await d(t,e),t):y(t,await f(e))}function y(t,e){return t.replaceWith(e),e}async function m(t,e){for(const[n,r]of Object.entries(e))if(n.startsWith("on")&&t[n]!==r)t[n]=async(...s)=>{await r(...s),await refresh()};else if(n==="style"&&typeof r=="object"){const s=t.style??{};for(const[o,c]of Object.entries(r))s[o]!==c&&(t.style[o]=c);for(const o of Object.keys(s))Object.hasOwnProperty.call(r,o)||delete t.style[o]}else t[n]!==r&&(t[n]=r);for(const n of Object.keys(t))Object.hasOwnProperty.call(e,n)||delete t[n]}async function g(t,e){const n=await Promise.all(e.map(i));let r=n.length,s=t.childNodes.length;for(let o=0;o<r;o++)o<s?await w(t.childNodes[o],n[o]):(t.append(await f(n[o])),s++);for(;s>r;){const o=t.childNodes[--s];t.removeChild(o)}}async function d(t,e){await m(t,e.attrs),await g(t,e.children)}let a=!1;async function f(t){if(typeof t=="string")return document.createTextNode(t);const e=a;a||(a=t.tag.toUpperCase()==="SVG");const n=a?document.createElementNS("http://www.w3.org/2000/svg",t.tag):document.createElement(t.tag);return await d(n,t),a=e,n}export function getParams(){return Object.fromEntries(new URL(window.location.href).searchParams.entries())}function p(t,e){const n=new URL(t,window.location.href);n.search="";for(const r of Object.keys(e).sort())n.searchParams.set(r,e[r]);return n}export async function setParams(t,e=!0){const n=p("",t);window.location.href!==n.href&&(e?window.history.pushState({},"",n):window.history.replaceState({},"",n)),await refresh()}function b(){let t="";async function e(){const n=window.location.href;n!==t&&(t=n,await refresh()),requestAnimationFrame(e)}e()}b();
