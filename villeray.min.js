const mounts=[];export async function load(e,t){const n=document.body.querySelector(e);null===n?console.log(new Error(`no match for '${e}' in document body`)):(mounts.push({elem:n,app:t}),await refresh())}export async function refresh(){const e=document.activeElement?.id??"";for(const e of mounts){const t=await transform(e.app());e.elem=await render(e.elem,t)}if(""!==e){const t=document.getElementById(e);if(null===t)return;const n=t.onfocus;delete t.onfocus,t.focus(),t.onfocus=n}}class VNode{constructor(e,t,n){if(Object.assign(this,{tag:e,attrs:t,children:n}),"a"===e){const e=buildURL(t.href??"",t.params??{});this.attrs={...t,href:e},void 0===t.href&&(this.attrs.onclick=e=>{e.ctrlKey||e.shiftKey||e.metaKey||(setParams(t.params??{}),e.preventDefault())})}}}export function h(e,t,...n){if("string"!=typeof e){const t="error: 'tag' must be a string";return console.log(new Error(t),e),`(${t})`}if("object"!=typeof t){const t="error: 'attrs' must be an object";return console.log(new Error(t),e),`(${t})`}return new VNode(e,t,n)}async function transform(e){switch(e?.constructor){case VNode:return e;case String:case Number:return String(e);case Boolean:return"";case Promise:return transform(await e);default:return h("pre",{},JSON.stringify(e,null,2))}}async function render(e,t){return"string"==typeof t?e.nodeType===Node.TEXT_NODE?(e.textContent!==t&&(e.textContent=t),e):replace(e,await createElem(t)):t.tag.toUpperCase()===e.tagName?(await setupElem(e,t),e):replace(e,await createElem(t))}function replace(e,t){return e.replaceWith(t),t}async function setAttributes(e,t){const n=e.vnode?.attrs??{};for(const[r,o]of Object.entries(t))if(r.startsWith("on")&&n[r]!==o)e[r]=async e=>{await o(e),await refresh()};else if("style"===r&&"object"==typeof o){const t=n.style??{};for(const[n,r]of Object.entries(o))t[n]!==r&&(e.style[n]=r);for(const n of Object.keys(t))Object.hasOwnProperty.call(o,n)||delete e.style[n]}else switch(r){case"value":case"selected":case"checked":e[r]!==o&&(e[r]=o);break;default:n[r]!==o&&(e[r]=o)}for(const r of Object.keys(n))Object.hasOwnProperty.call(t,r)||delete e[r]}async function setChildren(e,t){const n=await Promise.all(t.map(transform));let r=n.length,o=e.childNodes.length;for(let t=0;t<r;t++)t<o?await render(e.childNodes[t],n[t]):(e.append(await createElem(n[t])),o++);for(;o>r;){const t=e.childNodes[--o];e.removeChild(t)}}async function setupElem(e,t){await setAttributes(e,t.attrs),await setChildren(e,t.children),e.vnode=t}let inSVG=!1;async function createElem(e){if("string"==typeof e)return document.createTextNode(e);const t=inSVG;inSVG=inSVG||"SVG"===e.tag.toUpperCase();const n=inSVG?document.createElementNS("http://www.w3.org/2000/svg",e.tag):document.createElement(e.tag);return await setupElem(n,e),inSVG=t,n}export function getParams(){return Object.fromEntries(new URL(window.location.href).searchParams.entries())}function buildURL(e,t){const n=new URL(e,window.location.href);n.search="";for(const e of Object.keys(t).sort())n.searchParams.set(e,t[e]);return n}export async function setParams(e,t=!0){const n=buildURL("",e);window.location.href!==n.href&&(t?window.history.pushState({},"",n):window.history.replaceState({},"",n)),await refresh()}let oldURL="";function startWatchURL(){!async function e(){const t=window.location.href;t!==oldURL&&(oldURL=t,await refresh()),requestAnimationFrame(e)}()}startWatchURL();