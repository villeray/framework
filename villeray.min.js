const l=[];export async function mount(t,e){const n=document.body.querySelector(t);n===null?console.log(new Error(`no match for '${t}' in document body`)):(l.push({elem:n,app:e}),await refresh())}export async function refresh(){const t=document.activeElement?.id??"";for(const e of l){const n=await i(e.app());e.elem=await y(e.elem,n)}if(t!==""){const e=document.getElementById(t);if(e===null)return;const n=e.onfocus;delete e.onfocus,e.focus(),e.onfocus=n}}class w{constructor(e,n,r){var o;if(Object.assign(this,{tag:e,attrs:n,children:r}),e==="a"){const s=m(n.href??"",n.params??{});this.attrs={...n,href:s},n.href===void 0&&((o=this.attrs).onclick??(o.onclick=a=>{a.ctrlKey||a.shiftKey||a.metaKey||(setParams(n.params??{}),a.preventDefault())}))}}}export function h(t,e,...n){if(typeof t!="string"){const r="error: 'tag' must be a string";return console.log(new Error(r),t),`(${r})`}if(typeof e!="object"){const r="error: 'attrs' must be an object";return console.log(new Error(r),t),`(${r})`}return new w(t,e,n)}async function i(t){switch(t?.constructor){case w:return t;case String:case Number:return String(t);case Boolean:case void 0:return"";case Promise:return i(await t);default:return h("pre",{},JSON.stringify(t,null,2))}}async function y(t,e){return typeof e=="string"?t.nodeType===Node.TEXT_NODE?(t.textContent!==e&&(t.textContent=e),t):p(t,await f(e)):e.tag.toUpperCase()===t.tagName?(await d(t,e),t):p(t,await f(e))}function p(t,e){return t.replaceWith(e),e}async function g(t,e){const n=t.dataset.attrs??{};t.dataset.attrs=e;for(const[r,o]of Object.entries(e))if(r.startsWith("on")&&n[r]!==o)t[r]=async(...s)=>{await o(...s),await refresh()};else if(r==="style"&&typeof o=="object"){const s=n.style??{};for(const[a,u]of Object.entries(o))s[a]!==u&&(t.style[a]=u);for(const a of Object.values(s))Object.hasOwnProperty.call(o,a)||t.style.removeProperty(a)}else t[r]!==o&&(t[r]=o);for(const r of Object.keys(t))Object.hasOwnProperty.call(e,r)||delete t[r]}async function b(t,e){const n=await Promise.all(e.map(i));let r=n.length,o=t.childNodes.length;for(let s=0;s<r;s++)s<o?await y(t.childNodes[s],n[s]):(t.append(await f(n[s])),o++);for(;o>r;){const s=t.childNodes[--o];t.removeChild(s)}}async function d(t,e){await g(t,e.attrs),await b(t,e.children)}let c=!1;async function f(t){if(typeof t=="string")return document.createTextNode(t);const e=c;c||(c=t.tag.toUpperCase()==="SVG");const n=c?document.createElementNS("http://www.w3.org/2000/svg",t.tag):document.createElement(t.tag);return await d(n,t),c=e,n}export function getParams(){return Object.fromEntries(new URL(window.location.href).searchParams.entries())}function m(t,e){const n=new URL(t,window.location.href);n.search="";for(const r of Object.keys(e).sort())n.searchParams.set(r,e[r]);return n}export async function setParams(t,e=!0){const n=m("",t);window.location.href!==n.href&&(e?window.history.pushState({},"",n):window.history.replaceState({},"",n)),await refresh()}function O(){let t="";async function e(){const n=window.location.href;n!==t&&(t=n,await refresh()),requestAnimationFrame(e)}e()}O();
